<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="style.css">
<script type="text/javascript" src="jquery-1.7.1.min.js"></script>
<script type="text/javascript" src="jquery-ui-1.7.3.custom/js/jquery-ui-1.7.3.custom.min.js"></script>
<script language="javascript" type="text/javascript" src="datetimepicker.js"></script>
<script>
/////////////////////////////////////////////////////////////////////
//  ENTER THE NAME OF THE DATABASE                           ////////
/////////////////////////////////////////////////////////////////////
var dbName = "adv RPM";
if (!window.openDatabase) { alert('Databases are not supported in this browser.');  } 
else{
	var shortDbName = dbName.replace(/\s/g, "");
	var version = '1.0';    
	var maxSize = 20000000; //  bytes  
	var db = openDatabase(shortDbName, version, dbName, maxSize);
}
</script>

<script type="text/javascript">
var ListModShortNameArr = ['ModSubstrate', 'ModSL', 'ModML', 'ModStepper', 'ModEbeamWrite', 'ModRIE', 'ModMaskAlign', 'ModVSM', 'ModSQUID', 'ModMOKE', 'ModAFM', 'ModMFM', 'ModAlfaStep', 'ModTransport', 'ModAnnealing'];
var ListModLongNameArr = ['Substrate', 'Single Layer', 'Multilayer', 'Stepper', 'Ebeam Writer', 'RIE', 'ModMaskAlign', 'VSM', 'SQUID', 'MOKE', 'AFM', 'MFM', 'Alfa Step', 'Transport', 'Annealing'];
/////////////////////////////////////////////////////////////////////////////////
//horizontal scroll modules list in LeftRailfunction moveToClass(toClassName)  //
/////////////////////////////////////////////////////////////////////////////////
function moveToClass(toClassName){
	var listClass = ["DepoClass", "NanoFabClass", "MeasClass", "ProcessClass"];
	var index = listClass.indexOf(toClassName);
	var shift = -(index * 130)+'px';
	document.getElementById("listClass_content").style.marginLeft = shift;
}
/////////////////////////////////////////
// Expand the Arg bubbles of all Mods  //
/////////////////////////////////////////
function expandAllBox(){
	var listOfMods = arrSampleLifeLine();
	var listOfModsLength = listOfMods.length;
	for(var level = 0; level < listOfModsLength; level++){
		$("#argBox_lev"+level).css("height", "200px");
		$("#argBox_lev"+level).css("border", "1px solid #000000");
	}
}
function compactAllBox(){
	var listOfMods = arrSampleLifeLine();
	var listOfModsLength = listOfMods.length;
	for(var level = 0; level < listOfModsLength; level++){
		$("#argBox_lev"+level).css("height", "30px");
		$("#argBox_lev"+level).css("border", "0px solid #000000");
	}
}
/////////////////////////////////////////
// Show bubble of Sample ////////////////
/////////////////////////////////////////
function argSample(){
	var divArgSample = document.getElementById("argSample");
	var divArgSampleHeight = divArgSample.style.height.replace("px","");
	if(divArgSampleHeight > 31){
		divArgSample.style.height = "30px";
		divArgSample.style.border="0px solid #000000";
		document.getElementById("editArgSample").innerHTML = '<img src="images/collapse_arrow.png" width="20px" height="20px">';
	}
	else{
	divArgSample.style.height = "180px";
	divArgSample.style.border="1px solid #000000";
	document.getElementById("editArgSample").innerHTML = '<img src="images/compact_arrow.png" width="20px" height="20px">';
	}
}
///////////////////////////////////////////////////////////////////
//Replace Insert button by Update button on the first click      //
///////////////////////////////////////////////////////////////////
function showInsertSubmitButton(){
	document.getElementById("submitInsertButton").style.display = "none";
	document.getElementById("submitUpdateButton").style.display = "block";
}
// Replace Expanded View button by Compact View
function showCompactViewSubmitButton(){
	document.getElementById("submitExpandViewButton").style.display = "none";
	document.getElementById("submitCompactViewButton").style.display = "block";
}
function showExpandViewSubmitButton(){
	document.getElementById("submitCompactViewButton").style.display = "none";
	document.getElementById("submitExpandViewButton").style.display = "block";
}
//Write value of selected idProject in input field
function idProjectSelectValue(x){
	var y = document.getElementById("listProject_select").value; //y=idProject
	document.getElementById("idProject_Sample").value = y;
}
/////////////////////////////////////////////////////////////////////
// JQUERY COMMANDS //////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////
$(document).ready(function () {
/////////////////////////////////////////////////////////////////////////////
/////  SELECT TYPE OF PROJECTS TO DISPLAY IN THE List menuLeft  /////////////
/////////////////////////////////////////////////////////////////////////////
	$("#btn_showSamplesByStatus").change(function(event3){
		event3.preventDefault();
		var sampleList_displayValue = $(this).val();
		showListSamples(sampleList_displayValue);
	});	
///////////////////////////////////////////////	
//Edit the level argument (open the ArgBox)  //
///////////////////////////////////////////////
	$(".centerRail").delegate(".editLevel", "click", function(){
		var levelNumb = $(this).attr("name");
		levelNumb = levelNumb.replace("edit_","");
		var BoxHeight = $("#argBox_lev"+levelNumb).css("height");
		BoxHeight = BoxHeight.replace("px","");
		if(BoxHeight < 20){
			$("#argBox_lev"+levelNumb).css("height", "200px");
			$("#argBox_lev"+levelNumb).css("border", "1px solid #000000");
		}
		else{
			$("#argBox_lev"+levelNumb).css("height", "15px");
			$("#argBox_lev"+levelNumb).css("border", "1px solid #000000");
		}
	});
///////////////////////////////////////////////
//Drag and Drop   /////////////////////////////
///////////////////////////////////////////////
	$('.drag').draggable({
		containment: '.container',
		cursor: 'move',
		snap: '.hostModObj',
		helper: 'clone',
		//revert: true,
	});
	$(".hostModObj").droppable({
		accept: ".drag",
		drop: droppableOnTheFly,
	});
///////////////////////////////////////////////////////////
// In Chrome, without this command, when dragging and 
// dropping, text would be selected
	document.onselectstart = function () { return false; };
});

////////////////////////////////////////////////////////////
// Droppable on the fly
////////////////////////////////////////////////////////////
function droppableOnTheFly(event,ui){
		$(this).append($(ui.draggable).clone());
		var modName = $(ui.draggable).attr("name");
		$(this).attr("name", modName);
		$(this).droppable( 'disable' );
		var thiscount = $(this).attr("id");
		thiscount = thiscount.replace("level_","");
		var textLevel = '<div style="position:absolute; border:1px solid #000000; top:20px; left:115px; width:100px;" align="left"><img src="images/btn_delete.png" width="10px" height="10px" class="deleteLevel"> <div width="10px" height="10px" class="editLevel" name="edit_'+thiscount+'">show more</div>    <b>level '+thiscount+'</b></div>';
		$("#level_"+thiscount).append(textLevel); 
		var formText = eval('arg'+modName+'(-1,'+thiscount+', "showEmptyForm")'); //idsample=-1, just to state that no idsample is passed here
		$("#argBox_lev"+thiscount).append(formText);
		newcount = parseInt(thiscount)+ 1;
		var newLevelBox = '<tr><td align="center"><div class="hostModObj" id="level_'+newcount+ '"  name="" style="position:relative;"></div><div style="width:100%; height:0px; border:0px solid #000000; overflow:hidden; margin-bottom:10px; margin-top:2px" id="argBox_lev'+newcount+'" class="argBox" name=""></div></td></tr>';
		$(".listLevels").append(newLevelBox);
		$("#centerRail").find('#level_'+newcount).droppable({
			drop: droppableOnTheFly,
		});
 }
///////////////////////////////////////////////////
// Make a div to be droppable
///////////////////////////////////////////////////
function makeItDroppable(levelNumb){
 	$("#centerRail").find('#level_'+levelNumb).droppable({ 
		drop: droppableOnTheFly,
	});
}
//////////////////////////////////////////////////////////////////////////
//The sample Life Line form to be shown in centerRail)               /////
//////////////////////////////////////////////////////////////////////////
function sampleForm(){
	var text = '<div id="submitInsertButton" style="width:100px;"><button onClick="insertNewSample(); showInsertSubmitButton();" id="insert_newSample">Insert</button></div><div id="submitUpdateButton" style="width:100px; display:none"><button onClick="updateSample();" id="update_Sample">Update</button></div><div id="submitUpdateButton" style="width:100px; display:none"><button onClick="updateSample();" id="update_Sample">Update</button></div><div id="submitExpandViewButton" style="width:100px;"><button onClick="expandAllBox();showCompactViewSubmitButton()" id="expand_A">Expanded View</button></div><div id="submitCompactViewButton" style="width:100px; display:none;"><button onClick="compactAllBox();showExpandViewSubmitButton()" id="compact_A">Compact View</button></div>';
	text += '<div id="argSample" style="overflow:hidden; height:30px; margin-bottom:10px; border:1px solid #000000; width: 500px; margin-left:30px; margin-right:30px;"><input type="hidden" id="archiveStatus_Sample" value="0"/><input type="hidden" id="delStatus_Sample" value="0"/><input type="hidden" id="idSample" value=""/><input type="hidden" id="lastLevelInDB" value="-1"/>';
	text += '<table width="480px" border="0px"><tr><td width="380px">Name of Sample: <input type="text" id="sampleName_Sample" style="width:280px" onkeyup="check_SampleName();"/><td width="20px"><div id="showIDSample" onChange="showInsertSubmitButton()"></div></td><td width="10px"><div id="approve_sampleName" style="width:10px; height:10px; background-image:url(images/btn_error.png); border:0px solid #000000;"></div></td><td width="30px" align="right"><div style="width:60px; height:10px;" class="editArgSample" name="editArgSample" onClick="argSample()" id="editArgSample"><img src="images/collapse_arrow.png" width="20px" height="20px"></div></td></tr></table><div id="err_sampleName"></div>';
	text += '<table width="370px" border="0px" cellspacing="0px" cellpadding="0px"><tr><td width="80px">Creation date:</td><td width="80px"><input type="text" id="dateCreation_Sample" style="width:60px" readonly="readonly"/><a href="javascript:NewCal(\'dateCreation_Sample\',\'ddmmyyyy\',false,24)" alt="popup must be turned ON" title="popup must be turned ON"><img src="images/btn_calendar.gif" width="10px" border="0px solid #000000"></a></td><td width="40px"></td><td width="90px">Affiliated project:</td><td width="70px"><div id="listProject_selectForm"></div></td><td width="10px"><div id="approve_project" style="width:10px; height:10px; background-image:url(images/btn_error.png);"></div></td></tr></table><br><table width="370px" border="0px"><tr><td>Info:</td></tr><tr><td align="right"><textarea id="comments_Sample" style="width:360px; height:50px;"></textarea></td></tr></table></div>';
	text += '<table width="380px"  border="0px" class="listLevels" cellpadding="0px" cellspacing="0px" align="center" valign="center" id="listLevels"><tr height="15px"><td width="380px" align="center"><div class="hostModObj" id="level_0" name="" style="position:relative;z-index:0"></div><div style="width:100%; height:0px; border:0px solid #000000; overflow:hidden; margin-bottom:10px; margin-top:2px;" id="argBox_lev0" class="argBox"></div></td></tr></table>';
	document.getElementById("centerRail").innerHTML = text; // append the text form to the div centerRail
	makeItDroppable(0);	 //make level 0 to be droppable
	listProjects_form(); //create the drop down menu of the list of form in the Arg_box of samples
}

</script>
</head>
<title>Research Project Manager</title>
<body onLoad="sampleForm();" bgcolor="#8BA3b7">
<div style="position:absolute; top: 5px; left:20px; z-index:400"><img src="images/test1.png" width="100px" height="79px"></div><div style="position:relative; padding-top:20px; padding-left: 30px"><table width="100%" align="center" border="0px" cellspacing="0px" cellpadding="0px"><tr height="40px" valign="middle" align="left"><td style="padding-left:80px; width:60%"><font color="white" size="5px" style="font-family:Arial"><b>Research Project Manager</b></font></td><td valign="bottom"><font color="black" size="1px" style="font-family:Arial;"><i>let me help you <font color="white">organize</font> and <font color="white">keep track</font> of your research data!</i></font></td></tr></table></div>
<div style="width:930px; border-top:4px solid #FFFFFF;border-bottom:0px solid #FFFFFF; border-left:4px solid #FFFFFF; border-right:4px solid #FFFFFF; -moz-border-top-left-radius: 10px 10px; -moz-border-bottom-left-radius: 0px 0px; -moz-border-bottom-right-radius: 0px 0px; -moz-border-top-right-radius: 10px 10px; border-top-left-radius: 10px 10px; border-bottom-left-radius: 0px 0px; border-bottom-right-radius: 0px 0px; border-top-right-radius: 10px 10px; background-color:#4B6C88; padding-left:20px; padding-right:10px; height:30px">
<table align="right"><tr>
<td width="100px" align="center">
	<div style="width:80px; height:20px; border: 2px solid #ccc; -moz-border-top-left-radius: 4px 4px; -moz-border-bottom-left-radius: 4px 4px; -moz-border-bottom-right-radius: 4px 4px; -moz-border-top-right-radius: 4px 4px; border-top-left-radius: 4px 4px; border-bottom-left-radius: 4px 4px; border-bottom-right-radius: 4px 4px; border-top-right-radius: 4px 4px;background-color:#000000; opacity:0.4;filter:alpha(opacity=40); text-align:center;"><a href="samples.html" alt="List Of Samples" title="List Of Samples">Samples</a></div></td><td width="90px" align="center"><div style="width:80px; height:20px; border: 2px solid #ccc; -moz-border-top-left-radius: 4px 4px; -moz-border-bottom-left-radius: 4px 4px; -moz-border-bottom-right-radius: 4px 4px; -moz-border-top-right-radius: 4px 4px; border-top-left-radius: 4px 4px; border-bottom-left-radius: 4px 4px; border-bottom-right-radius: 4px 4px; border-top-right-radius: 4px 4px;background-color:#000000; opacity:0.4;filter:alpha(opacity=40); text-align:center;"><a href="projects.html" alt="List Of Projects" title="List Of Projects">Projects</a></div></td><td width="90px"><div style="width:80px; height:20px; border: 2px solid #ccc; -moz-border-top-left-radius: 4px 4px; -moz-border-bottom-left-radius: 4px 4px; -moz-border-bottom-right-radius: 4px 4px; -moz-border-top-right-radius: 4px 4px; border-top-left-radius: 4px 4px; border-bottom-left-radius: 4px 4px; border-bottom-right-radius: 4px 4px; border-top-right-radius: 4px 4px;background-color:#000000; opacity:0.4;filter:alpha(opacity=40); text-align:center;"><a href="projects.html" alt="List Of Projects" title="List Of Projects">Tools</a></div></td><td width="90px" align="center">	<div style="width:80px; height:20px; border: 2px solid #ccc; -moz-border-top-left-radius: 4px 4px; -moz-border-bottom-left-radius: 4px 4px; -moz-border-bottom-right-radius: 4px 4px; -moz-border-top-right-radius: 4px 4px; border-top-left-radius: 4px 4px; border-bottom-left-radius: 4px 4px; border-bottom-right-radius: 4px 4px; border-top-right-radius: 4px 4px;background-color:#000000; opacity:0.4;filter:alpha(opacity=40); text-align:center;"><a href="projects.html" alt="List Of Projects" title="List Of Projects">People</a></div></td><td width="90px" align="center">	<div style="width:80px; height:20px; border: 2px solid #ccc; -moz-border-top-left-radius: 4px 4px; -moz-border-bottom-left-radius: 4px 4px; -moz-border-bottom-right-radius: 4px 4px; -moz-border-top-right-radius: 4px 4px; border-top-left-radius: 4px 4px; border-bottom-left-radius: 4px 4px; border-bottom-right-radius: 4px 4px; border-top-right-radius: 4px 4px;background-color:#000000; opacity:0.4;filter:alpha(opacity=40); text-align:center;"><a href="projects.html" alt="List Of Projects" title="List Of Projects">Labs</a></div></td></tr></table></td></tr></table></div>

<div id="container" class="container">

<div id="leftRail" class="leftRail">
<b>Modules</b>

	<div id="listClass" class="listClass"><br>
	<div style="width:520px; border:0px solid #000000; padding-left:0px; margin-left:0px;" id="listClass_content">
		<table width="520px" align="left" cellspacing="0px" cellpadding="0px" border="0px"><tr><td width="130px" align="center" valign="top">
		<table width="120px" height="15px" cellpadding="0px" cellspacing="0px"  style="border-bottom:0px solid #000000;"><tr><td width="15px"></td><td align="center" width="90px" style="border-bottom:6px solid #FF0000;">Deposition</td><td width="15px"><div alt="NanoFabrication Class" title="NanoFabrication Class" style="z-index:100; height:15px; padding-left:2px; padding-right:2px;" onMouseOver="this.style.cursor='pointer'" onClick="moveToClass('NanoFabClass');">>></div></td></tr></table><br>
			<div id="module" class="drag" name="ModSubstrate" style="z-index:100;">Substrate</div>
			<div class="drag" id="module" name="ModML">Multilayer</div>
			<div id="module" class="drag" name="ModSL">Single Layer</div>
		</td><td width="130px" align="center" valign="top">
		<table width="120px" height="15px" cellpadding="0px" cellspacing="0px" style="border-bottom:0px solid #000000;"><tr><td width="15px"><div  title="Deposition Class" alt="Deposition Class" onClick="moveToClass('DepoClass');" style="z-index:100; height:15px; padding-left:2px; padding-right:2px;" onMouseOver="this.style.cursor='pointer'"><<</div></td><td align="center" width="90px" style="border-bottom:3px solid #FF0000;">NanoFabrication</td><td width="15px"><div title="Measurements Class" alt="Measurements Class" style="z-index:100; background-color:#F78D37; height:15px; padding-left:2px; padding-right:2px;" onMouseOver="this.style.cursor='pointer'" onClick="moveToClass('MeasClass');">>></div></td></tr></table><br>
			<div name="ModSpinCoat" class="drag" id="module">Spin Coating</div>
			<div name="ModIonMill" class="drag" id="module">Ion Milling</div>
			<div name="ModStepper" class="drag" id="module">Stepper</div>
			<div name="ModRIE" class="drag" id="module">RIE</div>
			<div name="ModEbeamWrite" class="drag" id="module">ebeam Writing</div>
			<div name="ModMaskAlign" class="drag" id="module">Mask Aligner</div>
		</td>
		<td width="130px" align="center" valign="top">
		<table width="120px" height="15px" cellpadding="0px" cellspacing="0px"  style="border-bottom:0px solid #000000;"><tr><td width="15px"><div  title="NanoFabrication Class" alt="NanoFabrication Class" style="z-index:100; height:15px; padding-left:2px; padding-right:2px;" onMouseOver="this.style.cursor='pointer'" onClick="moveToClass('NanoFabClass');"><<</div></td><td align="center" width="90px" style="border-bottom:3px solid #FF0000;">Measurements</td><td width="15px"><div title="Processing Class" alt="Processing Class" style="z-index:100; height:15px; padding-left:2px; padding-right:2px;" onMouseOver="this.style.cursor='pointer'" onClick="moveToClass('ProcessClass');">>></div></td></tr></table><br>
			<div name="ModVSM" class="drag" id="module">VSM</div>
			<div name="ModSQUID" class="drag" id="module">SQUID</div>
			<div name="ModMOKE" class="drag" id="module">MOKE</div>
			<div name="ModAFM" class="drag" id="module">AFM</div>
			<div name="ModMFM" class="drag" id="module">MFM</div>
			<div name="ModAlfaStep" class="drag" id="module">Alfa Step</div>
			<div name="ModTransport" class="drag" id="module">Transport</div>
		</td>
		<td width="130px" align="center" valign="top">
		<table width="120px" height="15px" cellpadding="0px" cellspacing="0px"  style="border-bottom:0px solid #000000;"><tr><td width="15px"><div  title="Measurements Class" alt="Measurements Class" style="z-index:100; height:15px; padding-left:2px; padding-right:2px;" onMouseOver="this.style.cursor='pointer'" onClick="moveToClass('MeasClass');"><<</div></td><td align="center" width="90px" style="border-bottom:3px solid #FF0000;">Processing</td><td width="15px"></td></tr></table><br>
			<div name="ModAnnealing" class="drag" id="module">Annealing</div>
		</td>
		</tr></table>

	</div>
</div>
</div>

  <div id="centerRail" class="centerRail" align="center"></div>

  <div id="rightRail" class="rightRail">
  	<form name="samplesDisplay_form">
<select name="btn_showSamplesByStatus" id="btn_showSamplesByStatus" style="width:130px; -moz-border-radius: .2em; -webkit-border-radius: .2em; order-radius: .2em; background: #B8D3EE; color: #FFFFFF;">
			<option value="-1">---</option>
			<option value="0" id="activeSamples">Active Samples</option>
			<option value="1" id="archivedSamples">Archived Samples</option>
			<option value="2" id="allSamples"> All Samples</option>
		</select></form>   <button onClick="sampleForm()" id="newSample">new sample</button><br>
		<div id="showTotalNumbSamples" style="width:205px; height:20px; margin-left:8px; padding-left:8px; padding-right:2px; background:#FFFFFF; border:1px solid #FFFFFF; -moz-border-top-left-radius: 4px 4px; -moz-border-bottom-left-radius: 4px 4px; -moz-border-bottom-right-radius: 4px 4px; -moz-border-top-right-radius: 4px 4px; border-top-left-radius: 4px 4px; border-bottom-left-radius: 4px 4px; border-bottom-right-radius: 4px 4px; border-top-right-radius: 4px 4px;"></div><br>
	<div id="sampleList" class="sampleList" style="margin-top: 0px;	padding-bottom: 0px; margin-bottom: 0px; margin-left: 0px; padding-left:0px;  margin-right: 0px; width:300px;"></div>
  </div>

</div>
  <div id="copyright" style="clear: left; background:#D4D4D4; width:860px; height:40px; border-left:4px solid #FFFFFF; border-right:4px solid #FFFFFF; border-bottom:4px solid #FFFFFF; border-top:0px solid #FFFFFF; -moz-border-top-left-radius: 0px 0px; -moz-border-bottom-left-radius: 10px 10px; -moz-border-bottom-right-radius: 10px 10px; -moz-border-top-right-radius: 0px 0px; border-top-left-radius: 0px 0px; border-bottom-left-radius: 10px 10px; border-bottom-right-radius: 10px 10px; border-top-right-radius: 0px 0px; padding-left:100px; padding-top:20px;"><b>Research Project Manager (c) 2012</b></div>
  </body>
 </html>
 <script>
 ////////////////////////////////////////////////////////
 //  check that the sample name does not already exist //
 ////////////////////////////////////////////////////////
function check_SampleName(){
	var sampleNameValue = sampleName_Sample.value;
	var set;
	var datasetLength;
	db.transaction(function(tx) {
		var selectAllSamplesName = "SELECT sampleName FROM SampleList WHERE sampleName = ?";
		tx.executeSql(selectAllSamplesName, [sampleNameValue], function(tx, result){
			set = result.rows;
			datasetLength = set.length;
			if(sampleNameValue.length > 0 && datasetLength == 0){
				err_sampleName.innerHTML = '';
				document.getElementById("approve_sampleName").style.backgroundImage="url('images/btn_check.jpg')";
			}
			else{
				if(datasetLength != 0){
					err_sampleName.innerHTML = '<font color="red"><i>this sample name is already in use</i></font>';
					document.getElementById("approve_sampleName").style.backgroundImage="url('images/btn_error.png')";
				}
			}
		});
	});	
}
 
/////////////////////////////////////////////////////////////////////////////////////
//This function retrieves the list of modules used in ascendant level order.	 ////
 ////////////////////////////////////////////////////////////////////////////////////
function arrSampleLifeLine(){
	var j = 0;
	var countSteps = 0;
	var arrSampleLifeLine = new Array();
	while(j == 0){
		idInputLevels = "level_"+countSteps;
		var containerStepID = document.getElementById(idInputLevels);
		var thisStepMod = containerStepID.getAttribute("name");
		if(thisStepMod.length == 0){
		j = 1;}
		else{
			arrSampleLifeLine.push(thisStepMod); //singleStep(level#,ModName)
			countSteps = countSteps + 1;
		}
	}
	//Need to check that there is no empty element in the array and that all 
	return arrSampleLifeLine;
}
/////////////////////////////////////////////////////////////////////////////////////
///   FUNCTION ERROR FOR THE SQL COMMANDS: open a div at the bottom of the page  ////
/////////////////////////////////////////////////////////////////////////////////////
function onError(tx, error) {
    var container = document.getElementById("container");
	//var errorDiv = '<div id="errorSql" style="position:fixed; bottom:0px; background-color:#FF0000">'+error.message+'</div>';
	alert(error.message);
	//container.innerHTML = '';
	//container.innerHTML += errorDiv;
}
////////////////////////////////////////////////////////////////////
////  List of function to edit modules and show modules Arguments //
////////////////////////////////////////////////////////////////////
//Record (Insert) the sampleLifeLine in the database
function insertNewSample(){	
	// insert new sample in sampleList
	var sampleName_Sample = document.getElementById('sampleName_Sample');
	var archiveStatus_Sample = document.getElementById('archiveStatus_Sample');
	var delStatus_Sample = document.getElementById('delStatus_Sample');
	var dateCreation_Sample = document.getElementById('dateCreation_Sample');
	var comments_Sample = document.getElementById('comments_Sample');
	var idProject_Sample = document.getElementById('idProject_Sample');
	var insertSampleList = "INSERT INTO SampleList (idProject, sampleName, dateCreation, sampleInfo, archiveStatus, delStatus) VALUES (?, ?, ?, ?, ?, ?)";
  //Select the id of the sample just added to sampleList
	db.transaction(function(tx) {
//INSERT INTO name_of_table (name_of_column1, name_of_column2) VALUES (value of parameter1, value_of_parameter2) 
		tx.executeSql(insertSampleList, [idProject_Sample.value, sampleName_Sample.value, dateCreation_Sample.value, comments_Sample.value, archiveStatus_Sample.value, delStatus_Sample.value], function(tx,res){	
		//Get the id of the inserted sample
			var selectIdSample = "SELECT id from SampleList order by id DESC limit 1";
			tx.executeSql(selectIdSample, [], function(tx,resIdSample){
				var datasetIdSample = resIdSample.rows;
				var itemIdSample = datasetIdSample.item(0);
				var idSample = itemIdSample['id'];
				//Show the IdSample value next to the sample name
				document.getElementById("showIDSample").innerHTML='#'+idSample;
				//set the value of the input id=idSample to idSample number for update later on
				document.getElementById("idSample").value = idSample;
				//Check that idSample has been created in the database

				//HERE
				
				///
				//Create an array containing the ModTbleName for each level starting at 0
				var arrSLL = arrSampleLifeLine();
				for(var i = 0; i < arrSLL.length; i++){
					var tbleName = arrSLL[i];
					window["arg"+tbleName](idSample, i, "insert");
				}
		}, onError);
	}, onError);
});
showListSamples();
}

////////////////////////////////////////////////////////////////////
////  List of function to update modules and show modules Arguments //
////////////////////////////////////////////////////////////////////
//Update the sampleLifeLine in the database
function updateSample(){	
	// update sample in sampleList
	var idSample = document.getElementById('idSample').value;
	//Update ArgBox Sample in SampleList
	var sampleNameValue = document.getElementById('sampleName_Sample').value;
	var archiveStatus_SampleValue = document.getElementById('archiveStatus_Sample').value;
	var delStatus_SampleValue = document.getElementById('delStatus_Sample').value;
	var dateCreation_SampleValue = document.getElementById('dateCreation_Sample').value;
	var comments_SampleValue = document.getElementById('comments_Sample').value;
	var idProject_SampleValue = document.getElementById('idProject_Sample').value;
	var updateSampleArg = "UPDATE SampleList SET idProject = ?, sampleName = ?, dateCreation = ?, sampleInfo = ?, archiveStatus = ?, delStatus = ? WHERE id = ?";
	db.transaction(function(tx) {
		tx.executeSql(updateSampleArg, [idProject_SampleValue, sampleNameValue, dateCreation_SampleValue, comments_SampleValue, archiveStatus_SampleValue, delStatus_SampleValue, idSample], null, onError);
    });
	// Update the ArgMod
		//Get the last Level saved in the database
	var lastLevelInDB = document.getElementById("lastLevelInDB").value;
	if(lastLevelInDB == -1){ var k_min = 0;} else { var k_min = parseFloat(lastLevelInDB)+1;}
	//STEP 1: Create the array of the Sample Life Line
	var arrSLL = arrSampleLifeLine();
	//Insert the newly added Mod in the DB
				for(var k = k_min ; k < arrSLL.length; k++){
					var tbleName = arrSLL[k];
					window["arg"+tbleName](idSample, k, "insert");
				}
	//Update the Mod that were already in the DB
				for(var k = 0 ; k < k_min; k++){
					var tbleName = arrSLL[k];
					window["arg"+tbleName](idSample, k, "update");
				}
			var SampleList = document.getElementById("sampleList");
			var cleared = 0;
			while(SampleList.firstChild){
				SampleList.removeChild(SampleList.firstChild);
				cleared = 1;
			}
			if(cleared == 1){
				showListSamples();
			}
}
</script>

<!-- ////////////////////////////////////////////////////
///////    INSERT ARGUMENT VALUES OF MODULE SUBSTRATE  //
////////////////////////////////////////////////////////!-->
<script type="text/javascript" src="ArgMods_IUS.js"></script>




<script>
/////////////////////////////////////////
// LIST OF SAMPLES RIGHT MENU
/////////////////////////////////////////
function showListSamples(n) {
	sampleList.innerHTML = '';
    db.transaction(function(tx) {
		if(n == 2){ //Show all Samples
			var selectAllSamples = "SELECT SampleList.id, SampleList.idProject, SampleList.sampleName, SampleList.dateCreation, SampleList.archiveStatus, SampleList.delStatus, ProjectList.colorCode FROM SampleList LEFT JOIN ProjectList ON SampleList.idProject = ProjectList.id WHERE SampleList.delStatus = 0";
			var btn_changeStatus;
			var action;
			var alt_btnChangeStatus;
		}
		else if(n == 1){ //Show archived Samples
			var selectAllSamples = "SELECT SampleList.id, SampleList.idProject, SampleList.sampleName, SampleList.dateCreation, SampleList.archiveStatus, SampleList.delStatus, ProjectList.colorCode FROM SampleList LEFT JOIN ProjectList ON SampleList.idProject = ProjectList.id WHERE SampleList.archiveStatus = 1 AND SampleList.delStatus = 0";
			// show wake-up button
			var btn_changeStatus = 'btn_wakeup.png';
			var alt_btnChangeStatus = 'make active'; 
			var action = 'activateSample';
		}
		else{ //default show active samples
var selectAllSamples = "SELECT SampleList.id, SampleList.idProject, SampleList.sampleName, SampleList.dateCreation, SampleList.archiveStatus, SampleList.delStatus, ProjectList.colorCode FROM SampleList LEFT JOIN ProjectList ON SampleList.idProject = ProjectList.id WHERE SampleList.archiveStatus = 0 AND SampleList.delStatus = 0";
			//show button sleep (hide)
			var btn_changeStatus = 'btn_sleep.png';
			var alt_btnChangeStatus = 'archive';
			var action = 'archiveSample';
		}
		tx.executeSql(selectAllSamples, [], function(tx, result) {
			dataset = result.rows;
			var count = dataset.length;
			var sampleArchiveStatus;
			for (var i = 0, item = null; i < count; i++) {
				item = dataset.item(i);
				sampleArchiveStatus = item['archiveStatus'];
			// When showing all projects (n=2), Show button sleep or wakeup depending on the status of the sample
				if(n == 2){
					if(item['archiveStatus'] == 1){ //sample is sleepy (hidden)
					btn_changeStatus = 'btn_wakeup.png';
					alt_btnChangeStatus = 'make active'; 
					action = 'activateSample';
					}
					else{ //Sample is awake (not=hidden)
					btn_changeStatus = 'btn_sleep.png';
					alt_btnChangeStatus = 'archive'; 
					action = 'archiveSample';
					}
				}
				var singleSampleStyleOdd='list-style: none; border:1px solid #BCBCBC; padding-left:2px; font-size:11px; font-family: Arial; color: #000000; margin-top: 4px; margin-bottom: 2px; margin-right:2px; background-color:#CCCCCC; display:block; width:220px; overflow: hidden; height:20px';
				var singleSampleStyleEven='list-style: none; border:1px solid #BCBCBC; padding-left:2px; font-size:11px; font-family: Arial; color: #000000; margin-top: 4px; margin-bottom: 2px; margin-right:2px; background-color:#EEEEEE; display:block; width:220px; overflow: hidden;  height:20px;';
				if(i%2 == 0){ var thisStyle = singleSampleStyleEven; }
				else{ var thisStyle = singleSampleStyleOdd; }
				var DivId = 'div'+item['id'];
				var colorCode = item['colorCode'];
				var dateCreation = item['dateCreation'];
				var yearDateCreation = dateCreation.substr(-4);
				var idSample = item['id'];
				var sampleName = item['sampleName'];
				var shortSampleName = sampleName.substring(0,10);
				var sampleText = '<div id="'+DivId+'" style="'+thisStyle+'" class="listSamplesDiv"><table width="220px" border="0px" cellspacing="0px" cellpadding="0px"><tr height="20px"><td><table width="220px" border="0px" cellspacing="0px" cellpadding="0px"><tr><td width="18px"><div style="width:10px; height:10px; border: 0px solid #000000; background:'+ colorCode + '; -moz-border-top-left-radius: 4px 4px; -moz-border-bottom-left-radius: 4px 4px; -moz-border-bottom-right-radius: 4px 4p	x; -moz-border-top-right-radius: 4px 4px; border-top-left-radius: 4px 4px; border-bottom-left-radius: 4px 4px; border-bottom-right-radius: 4px 4px; border-top-right-radius: 4px 4px;"></div></td><td width="142px"><div id="ttSpName'+idSample+'" class="ttSpName" alt="'+sampleName+'" title="'+sampleName+'" style="border:0px solid #000000">'+ shortSampleName + '(<span tag="'+dateCreation+'" title="'+dateCreation+'">'+ yearDateCreation +'</span>)</div></td><td width="10px"><div id="warningParameters'+idSample+'"></div></td><td width="15px"><div style="border:1px solid #CCCCCC; width:14px;"><a href="#" onclick="editSample('+idSample+'); showInsertSubmitButton()"><img src="images/btn_edit.png" width="14px" alt="edit" title="edit"></a></div></td><td width="20px"><a href="#" onclick="'+action+'('+idSample+')"><img src="images/'+btn_changeStatus+'" alt="'+alt_btnChangeStatus+'" title="'+alt_btnChangeStatus+'"></a></td><td width="20px"><a href="#" onclick="deleteSample('+idSample+')"><img src="images/btn_delete.png" alt="delete" title="delete" width="12px" height="12px"></a></td></tr></table></td></tr></table></div>';
				sampleList.innerHTML += sampleText;
			}
			if(n == 2){ //Counts the number of "all samples"
					if(count > 0 ){
					showTotalNumbSamples.innerHTML = 'Total of <b>'+count+'</b> <i>samples</i>';
					}
					else{
					showTotalNumbSamples.innerHTML = '<b>0</b> <i>samples</i>';
					}
				}
				else if(n == 1){ //Counts "hidden" or "Archived" samples
					if(count > 0 ){
						showTotalNumbSamples.innerHTML = 'Total of <b>'+count+'</b> <i>archived samples</i>';
					}
					else{
						showTotalNumbSamples.innerHTML = '<b>0</b> <i>archived samples</i>';
					}
				}
				else { //Counts the number of " active samples"
					if(count > 0 ){
						showTotalNumbSamples.innerHTML = 'Total of <b>'+count+'</b> <i>active samples</i>';
					}
					else{
						showTotalNumbSamples.innerHTML = '<b>0</b> <i>active samples</i>';
					}
				
				}
		}, onError);
	});
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////     Delete a sample : <a href="#" onclick="deleteSample('+idSample+')"> and all associated modules levels//////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function deleteSample(idSample){
	var answer = confirm("Do you really want to delete this sample?");
	if (answer){
		var delStatus = 1; //delete the Sample (delStatus)
		db.transaction(function(tx) {	
		var updateDeleteSample = "UPDATE SampleList SET delStatus = ? WHERE id = ?";
		tx.executeSql(updateDeleteSample, [delStatus, idSample], function(tx){
		showListSamples();
		//centerRail.innerHTML = '';   //empty the div "content	  
	  }, onError);
		}); 
	}	
}

/////////////////////////////////////////////////////////////////
////////////      EDIT SAMPLE       /////////////////////////////        /////////////////////////////////////////////////////////////////
function editSample(idSample){
	sampleForm(); // load the SampleLife Line form (empty) in centerRail.
	var centerRail = document.getElementById("centerRail");
	//Fill up the Arg inputs with that of this Sample
	var datasetArgSample;
	db.transaction(function(tx){
		var selectThisSampleArg = "SELECT * FROM SampleList WHERE id = ?";
		tx.executeSql(selectThisSampleArg, [idSample], function(tx, result) {
			datasetArgSample = result.rows;
			var argSample;
			// Fill up the input of SampleArg
			argSample = datasetArgSample.item(0);
			document.getElementById("idSample").value = argSample['id'];
			document.getElementById("archiveStatus_Sample").value = argSample['archiveStatus'];
			document.getElementById("delStatus_Sample").value = argSample['delStatus'];
			document.getElementById("sampleName_Sample").value = argSample['sampleName'];
			document.getElementById("dateCreation_Sample").value = argSample['dateCreation'];
			document.getElementById("idProject_Sample").value = argSample['idProject'];
			document.getElementById("comments_Sample").value = argSample['sampleInfo'];
			var select = document.getElementById("listProject_select");
			var items = select.getElementsByTagName("option");
				for (var x = 0; x < items.length; x++) { 
					if (select.options[x].value == argSample['idProject']) { 
						select.options[x].selected = true; 
					} 
				}
			var selectThisSampleLifeLine = "SELECT * FROM SampleLifeLine WHERE idSample = ? AND delStatus = ? ORDER BY ModLevel ASC";
			var datasetMod;
			tx.executeSql(selectThisSampleLifeLine, [idSample, 0], function(tx, resMod) {
				datasetMod = resMod.rows;
				var thisLifeLine;
				//Backup the last level of the SampleLifeLine
				document.getElementById("lastLevelInDB").value = datasetMod.length-1;
				if(datasetMod.length > 0){ // execute only if at least a single Mod is found
					//Build the SampleLifeLine
					for (var i = 0, thisLifeLine = null; i < datasetMod.length; i++) {
						thisLifeLine = datasetMod.item(i);
						var thisModTble = thisLifeLine['ModTble'];
						var thisIdMod = thisLifeLine['idMod'];
						var thisModLevel = thisLifeLine['ModLevel'];
						var listLevelsTable = document.getElementById("listLevels");
						if(i == 0){//First remove the first row in the table id="listLevels"
							listLevelsTable.deleteRow(0);
						}
					//Create a new row and a new cell
						var listLevelsTable = document.getElementById("listLevels");
						var newRow = listLevelsTable.insertRow(i);
						var newCell = newRow.insertCell(0);
					//Get the long name of the Mod (ModLongName) to display on the drag and drop box
						var pos = ListModShortNameArr.indexOf(thisModTble);
						var ModLongName = ListModLongNameArr[pos];
						var textNewCell = '<div class="hostModObj" id="level_'+thisModLevel+'" name="'+thisModTble+'" style="position:relative;z-index:0"><div class="drag" id="module" name="'+thisModTble+'">'+ModLongName+'</div><div style="position:absolute; border:1px solid #000000; top:20px; left:115px; width:100px;" align="left"><img src="images/btn_delete.png" width="10px" height="10px" class="deleteLevel"> <img src="images/btn_edit.png" width="10px" height="10px" class="editLevel" name="edit_'+thisModLevel+'">    <b>level '+thisModLevel+'</b></div></div><div style="width:100%; height:0px; border:0px solid #000000; overflow:hidden; margin-bottom:10px; margin-top:2px;" id="argBox_lev'+thisModLevel+'" class="argBox"></div>';
						newCell.innerHTML = textNewCell;
						newCell.width = "380px";
						newCell.align = "center";
						newRow.height="15px";
					//Write the form in the ArdMod Box
						var thisModForm = window["arg"+thisModTble](idSample, i, "showEmptyForm");
						document.getElementById("argBox_lev"+thisModLevel).innerHTML = thisModForm;
						window["arg"+thisModTble](idSample, i, "edit");
					// Get data in the database for thisModLevel and write it in the the form 'thisModForm'
					}
					// add an empty droppable box
					var newRow = listLevelsTable.insertRow(-1);
					var newCell = newRow.insertCell(0);
					var thisModLevel = datasetMod.length;
					var textNewCell = '<div class="hostModObj" id="level_'+thisModLevel+'" name="" style="position:relative;z-index:0"></div><div style="width:100%; height:0px; border:0px solid #000000; overflow:hidden; margin-bottom:10px; margin-top:2px;" id="argBox_lev'+thisModLevel+'" class="argBox"></div>';
					newCell.innerHTML = textNewCell;
					newCell.width = "380px";
					newCell.align = "center";
					newRow.height="15px"
					makeItDroppable(thisModLevel);	
					}
				}, onError);
		}, onError);
	});
}
//////////////////////////////////////////////////////////////////////////////////////////
////     Archive sample: sample might be inactive and off interest)                 //////
////////////////////////////////////////////////////////////////////////////////////////// 
function archiveSample(idSample){
var sampleList = document.getElementById("sampleList");
var centerRail = document.getElementById("centerRail");
	db.transaction(function(tx) {
		var ArchiveStatus = 1; //Archive The sample
		var updateArchiveSample = "UPDATE SampleList SET archiveStatus = ? WHERE id = ?";
      tx.executeSql(updateArchiveSample, [ArchiveStatus, idSample], null, onError);
		}); 
	sampleList.innerHTML = '';
	showListSamples();
	//Set the <form> displayProjectStyle = show Active project
	var displaySampleList = document.getElementById("samplesDisplay_form");;
	//Disable option 1 and 2: show Archived and All Projects
	var ActiveSDisplayOption = document.getElementById("activeSamples");
	ActiveSDisplayOption.selected = true;
	var ArchivedSDisplayOption = document.getElementById("archivedSamples");
	ArchivedSDisplayOption.selected = false;
	var AllSDisplayOption = document.getElementById("allSamples");
	AllSDisplayOption.selected = false;	
}
///////////////////////////////////////////////////////////////////////////////
//WakeUP Sample from general Left_menu (sample might be again of interest) ////
///////////////////////////////////////////////////////////////////////////////
function activateSample(idSample){
	db.transaction(function(tx) {
		var archiveStatus = 0; //show (active) sample            
		var updateArchiveSample = "UPDATE SampleList SET archiveStatus = ? WHERE id = ?";
		//When Sample is wokeUp make sure to wakeup the project it is affiliated with
		tx.executeSql(updateArchiveSample, [archiveStatus, idSample], function(tx){
			showListSamples(); //reload the list of active samples
			//the drop down menu must show the option active sample selected
			var ActiveSDisplayOption = document.getElementById("activeSamples");
			ActiveSDisplayOption.selected = true;
		}, onError);
		//update thisProject archiveStatus to 0
				var updateArchiveSample = "UPDATE SampleList SET archiveStatus = ? WHERE id = ?";
	});
}
/////////////////////////////////////////////////////////////////
//  List of projects for the drop/down menu in Sample Arg box  //
/////////////////////////////////////////////////////////////////
function listProjects_form(){
	db.transaction(function(tx) {
		var selectAllProjects = "SELECT * FROM ProjectList WHERE delStatus = ? AND archiveStatus = ?";
		tx.executeSql(selectAllProjects, [0, 0], function(tx, result) {
			var dataset = result.rows;
			var project;
			listProject_selectForm.innerHTML = ''; 
			if(dataset.length > 0){
				listProject_selectForm.innerHTML = '<form name="listProject_form" id="listProject_form"><select name="listProject_select" id="listProject_select" onChange="idProjectSelectValue(this.selectedIndex);"><option value="0">---</option></select></form>';
				var objSelect=document.forms["listProject_form"].elements["listProject_select"];
				for (var i = 0, project = null; i < dataset.length; i++) {
					project = dataset.item(i);
					var objOption = document.createElement("option");
					document.listProject_form.listProject_select.options.add(objOption);
					objOption.text = project['projectName'];
					objOption.value = project['id'];
				}
			listProject_selectForm.innerHTML += '<input type="hidden" id="idProject_Sample" value=""/>'; 
			}
			else{
				listProjectSelectForm.innerHTML = 'No project available. Go <a href="projects.html">here</a> to enter a project.'
			}
		});
	});
}
</script>